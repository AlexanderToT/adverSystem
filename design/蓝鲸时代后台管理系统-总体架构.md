# 蓝鲸时代后台管理系统-总体架构

## 1. 项目概述

蓝鲸时代后台管理系统是一个广告管理平台，主要用于广告投放、应用接入和监测数据的管理。系统包括账号管理、应用管理和广告管理三大核心模块，为广告运营提供全面支持。

## 2. 技术栈

### 前端
- 框架：React 18
- UI库：Ant Design
- 样式：Less
- 状态管理：Redux Toolkit
- 路由：React Router 6
- 请求库：Axios
- 构建工具：Vite

### 后端
- 框架：Hono.js Cloudflare Workers模版
- 数据库：PostgreSQL
- ORM：Drizzle-kit
- 缓存：Redis
- 认证授权：JWT
- API文档：OpenAPI/Swagger
- 文件存储：Cloudflare R2 (用于存储广告素材等文件)
111
222
333
## 3. 总体架构

### 3.1 系统架构图

```
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐      ┌──────────────────┐
│                 │      │                 │      │                 │      │                  │
│  客户端(浏览器)  │◄────►│  前端应用服务器  │◄────►│  后端API服务器   │◄────►│ Cloudflare R2    │
│                 │      │  (Cloudflare   │      │  (Cloudflare    │      │ (文件存储)       │
└─────────────────┘      │   Pages/Nginx)  │      │   Workers)      │      │                  │
                         └─────────────────┘      └────────┬────────┘      └──────────────────┘
                                                           │
                                                           │
                                                  ┌────────▼────────┐
                                                  │                 │
                                                  │   PostgreSQL    │
                                                  │                 │
                                                  └────────┬────────┘
                                                           │
                                                           │
                                                  ┌────────▼────────┐      ┌──────────────────────┐
                                                  │                 │      │                      │
                                                  │     Redis       │      │ Cloudflare Analytics │
                                                  │                 │      │ (广告统计数据)        │
                                                  └─────────────────┘      └──────────────────────┘
```

### 3.2 系统模块结构

```
蓝鲸时代后台管理系统
├── 用户认证与授权系统
├── 账号管理模块
│   ├── 账号列表（用户ID、登录类型、用户名称）
│   └── 角色管理（普通用户、超级管理员）
├── 应用管理模块
│   ├── 应用列表管理（基础信息、API/iOS配置）
│   ├── 广告位管理（流量广告、广告位创建与配置）
│   └── 数据统计（应用监控、广告位分析）
├── 广告管理模块
│   ├── 广告素材管理（素材库、图片/视频/banner）
│   ├── 广告投放管理（计划管理、投放设置）
│   └── 数据统计与报表（效果分析、转化率统计）
└── 系统管理模块
```

### 3.3 前端项目结构
```
src/
├── assets/          # 静态资源
├── components/      # 公共组件
├── config/          # 配置文件
├── hooks/           # 自定义钩子
├── layouts/         # 布局组件
├── pages/           # 页面组件
│   ├── account/     # 账号管理页面
│   ├── application/ # 应用管理页面
│   └── advertisement/ # 广告管理页面
├── services/        # API服务
├── store/           # Redux状态管理
├── styles/          # 全局样式（SCSS）
├── types/           # TypeScript类型定义
└── utils/           # 工具函数
```

### 3.4 后端项目结构
```
src/
├── api/             # API路由定义
├── controllers/     # 控制器
│   ├── account/     # 账号相关控制器
│   ├── application/ # 应用相关控制器
│   └── advertisement/ # 广告相关控制器
├── middleware/      # 中间件
├── models/          # 数据模型
│   ├── user.ts      # 用户模型
│   ├── application.ts # 应用模型
│   ├── adPosition.ts # 广告位模型
│   └── advertisement.ts # 广告模型
├── db/              # Drizzle模式文件和数据库配置
├── services/        # 业务逻辑
├── utils/           # 工具函数
└── index.ts         # 应用入口
```

## 4. 前端开发规范

### 4.1 命名规范
- 组件使用PascalCase命名，如`AccountList.tsx`
- 函数和变量使用camelCase命名，如`getUserInfo`
- 常量使用UPPER_SNAKE_CASE命名，如`API_BASE_URL`

### 4.2 代码风格
- 使用ESLint和Prettier保持代码风格一致
- 遵循函数式编程原则
- 使用TypeScript强类型

### 4.3 组件开发
- 遵循单一职责原则
- 使用函数组件和Hooks
- 合理拆分和复用组件

## 5. 后端开发规范

### 5.1 API规范
- 采用RESTful API设计
- 使用统一的响应格式

```typescript
// 统一响应格式
export interface ApiResponse<T> {
  code: number;
  message: string;
  data: T | null;
}

// 成功响应
export const success = <T>(data: T): ApiResponse<T> => ({
  code: 200,
  message: '操作成功',
  data
});

// 错误响应
export const error = (message: string): ApiResponse<null> => ({
  code: 500,
  message,
  data: null
});
```

### 5.2 数据模型设计

```typescript
// 用户模型
export interface User {
  id: string;
  username: string;
  password: string;
  loginType: string;
  role: string;
  status: string;
  createdAt: Date;
  updatedAt: Date;
}

// 应用模型
export interface Application {
  id: string;
  name: string;
  apiKey: string;
  iosConfig: any;
  status: string;
  createdAt: Date;
  updatedAt: Date;
}

// 广告位模型
export interface AdPosition {
  id: string;
  appId: string;
  name: string;
  type: string;
  size: string;
  config: any;
  status: string;
  createdAt: Date;
  updatedAt: Date;
}

// 广告模型
export interface Advertisement {
  id: string;
  name: string;
  adPositionId: string;
  materialType: string;
  materialUrl: string;
  landingUrl: string;
  startTime: Date;
  endTime: Date;
  status: string;
  createdAt: Date;
  updatedAt: Date;
}
```

### 5.3 代码规范
- 使用TypeScript强类型
- 遵循单一职责原则
- 使用依赖注入模式
- 错误处理统一化

## 6. 部署指南

### 6.1 前端部署
1. 安装依赖: `npm install`
2. 构建生产环境代码: `npm run build`
3. 将dist目录下的文件部署到Nginx或其他Web服务器

### 6.2 后端部署
1. 安装依赖: `npm install`
2. 构建生产环境代码: `npm run build`
3. 部署到Cloudflare Workers: `wrangler publish`

### 6.3 数据库配置
- 本地开发数据库连接: `postgres://pguser:123456@localhost:5432/adverAdmin`
- 确保PostgreSQL已安装并运行
- 使用Drizzle-kit进行数据库迁移

### 6.4 外部服务集成
- **Cloudflare R2**: 用于存储用户上传的广告素材（图片、视频等）。后端应用在处理文件上传时，会将文件存储到R2，并在数据库中保存对应的R2对象URL。
- **Cloudflare Analytics Engine**: 推荐用于收集和分析广告统计数据（如曝光、点击）。后端应用或直接通过边缘计算（如Workers）将统计事件写入Analytics Engine，并通过其API进行查询。

## 7. 开发流程

1. 需求分析与设计
2. 数据库设计
3. API接口设计
4. 后端开发
5. 前端开发
6. 单元测试
7. 集成测试
8. 部署上线

## 8. 模块详细设计

### 8.1 账号管理模块

#### 8.1.1 功能描述
账号管理模块负责系统用户的管理、权限分配及登录验证。

#### 8.1.2 子模块划分
- 账号列表：用户ID管理、登录类型设置、用户名称维护
- 角色管理：角色权限配置（普通用户、超级管理员）、权限分配

#### 8.1.3 API接口
- 账号管理API: `/api/users`
- 权限管理API: `/api/roles`, `/api/permissions`

### 8.2 应用管理模块

#### 8.2.1 功能描述
应用管理模块负责管理广告应用和广告位配置。

#### 8.2.2 子模块划分
- 应用列表管理：应用基础信息、API/iOS配置、权限设置
- 广告位管理：流量广告配置、广告位创建与管理、广告位配置
- 数据统计：应用数据监控、广告位数据分析

#### 8.2.3 API接口
- 应用管理API: `/api/applications`
- 广告位管理API: `/api/adpositions`

### 8.3 广告管理模块

#### 8.3.1 功能描述
广告管理模块负责广告素材管理、投放管理以及相关数据统计。

#### 8.3.2 子模块划分
- 广告素材管理：素材库管理、图片/视频/banner管理、素材分类
- 广告投放管理：广告计划管理、投放条件设置、定向投放
- 数据统计与报表：广告效果分析、转化率统计、报表导出

#### 8.3.3 API接口
- 广告管理API: `/api/advertisements`
- 广告素材API: `/api/materials`
- 数据统计API: `/api/statistics`

## 9. 项目规范

1. 代码规范遵循各自语言的官方推荐规范
2. Git提交信息格式: `type(scope): subject`
3. 分支管理策略: GitFlow
4. 版本号遵循语义化版本(Semantic Versioning)规范 